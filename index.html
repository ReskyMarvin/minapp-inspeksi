<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini App Starter</title>
  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      /* Fallbacks */
      --bg: #0f0f0f;
      --fg: #ffffff;
      --card: #1b1b1b;
      --muted: #a0a0a0;
      --accent: #3b82f6;
    }
    /* Adapt to Telegram theme automatically */
    @media (prefers-color-scheme: light) {
      :root { --bg: #ffffff; --fg: #111111; --card: #f5f5f5; --muted: #666; }
    }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--fg);
    }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 16px; }
    .card { width: 100%; max-width: 560px; background: var(--card); border-radius: 16px; padding: 18px; box-shadow: 0 8px 24px rgba(0,0,0,.2); }
    h1 { font-size: 1.25rem; margin: 0 0 12px; }
    p { margin: 0 0 16px; color: var(--muted); }
    form { display: grid; gap: 12px; }
    .row { display: grid; gap: 12px; }
    @media (min-width: 560px) { .row { grid-template-columns: 1fr 1fr; } }
    label { font-size: .9rem; color: var(--muted); }
    input, select, textarea {
      width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04); color: var(--fg); outline: none;
    }
    input::placeholder { color: #9aa0a6; }
    .hint { font-size: .8rem; color: var(--muted); }
    .divider { height: 1px; background: rgba(255,255,255,.08); margin: 8px 0 12px; }
    .footer { display: flex; gap: 8px; justify-content: space-between; align-items: center; margin-top: 6px; }
    .btn {
      padding: 12px 14px; border-radius: 12px; border: none; cursor: pointer;
      background: var(--accent); color: white; font-weight: 600; width: 100%;
    }
    .ghost { background: transparent; border: 1px solid rgba(255,255,255,.14); color: var(--fg); }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Form Inspeksi (Demo)</h1>
      <p>Contoh Mini App responsif. Data akan dikirim balik ke bot menggunakan <code>sendData()</code>.</p>

      <form id="form">
        <div class="row">
          <div>
            <label for="container">Container</label>
            <input id="container" name="container" placeholder="C1 / C2 / ..." required />
          </div>
          <div>
            <label for="date">Date</label>
            <input id="date" name="date" type="date" required />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="seal">Seal No</label>
            <input id="seal" name="seal" placeholder="e.g. ABC123" required />
          </div>
          <div>
            <label for="plate">Plate No</label>
            <input id="plate" name="plate" placeholder="DB 1234 XX" required />
          </div>
        </div>
        <div>
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" rows="3" placeholder="Catatan (opsional)"></textarea>
          <div class="hint">Tekan tombol "Kirim" (MainButton) untuk submit.</div>
        </div>
        <div class="divider"></div>
        <div class="footer">
          <button type="button" id="reset" class="btn ghost">Reset</button>
          <button type="submit" class="btn">Kirim</button>
        </div>
      </form>

      <div id="ok" class="hidden hint">Terkirim. Kamu bisa menutup Mini App ini.</div>
    </div>
  </div>

  <script>
    // --- Telegram SDK bootstrap ---
    const tg = window.Telegram?.WebApp;
    tg?.ready();            // Tell Telegram we are ready
    tg?.expand();           // Expand to full height

    // Optional: mirror theme to CSS vars (for nicer theming)
    function applyTheme() {
      if (!tg) return;
      const theme = tg.themeParams || {};
      const map = {
        '--bg': theme.bg_color,
        '--fg': theme.text_color,
        '--card': theme.secondary_bg_color,
        '--muted': theme.hint_color,
        '--accent': theme.button_color,
      };
      for (const k in map) if (map[k]) document.documentElement.style.setProperty(k, map[k]);
      if (theme.button_text_color) document.documentElement.style.setProperty('--btnText', theme.button_text_color);
    }
    applyTheme();

    // --- Form logic ---
    const form = document.getElementById('form');
    const ok   = document.getElementById('ok');
    const resetBtn = document.getElementById('reset');

    // Hook Telegram MainButton as duplicate submit
    if (tg) {
      tg.MainButton.setText('Kirim');
      tg.MainButton.onClick(() => submitForm());
      tg.MainButton.show();
    }

    resetBtn.addEventListener('click', () => {
      form.reset();
      ok.classList.add('hidden');
      tg?.MainButton.show();
    });

    form.addEventListener('submit', (e) => { e.preventDefault(); submitForm(); });

    function collect() {
      const fd = new FormData(form);
      const data = Object.fromEntries(fd.entries());
      // Example: enforce uppercase for several fields
      ['container','seal','plate'].forEach(k => data[k] = (data[k]||'').toUpperCase());
      return data;
    }

    function submitForm() {
      const data = collect();

      // Basic client-side validation
      if (!data.container || !data.date || !data.seal || !data.plate) {
        if (tg) tg.HapticFeedback.notificationOccurred('error');
        alert('Lengkapi semua field wajib.');
        return;
      }

      const payload = { type: 'inspection_demo', data };

      if (tg) {
        tg.sendData(JSON.stringify(payload)); // Delivered to your bot as message.web_app_data
        tg.HapticFeedback.impactOccurred('light');
        tg.MainButton.hide();
      }
      ok.classList.remove('hidden');
    }

    // Pre-fill date with today
    document.getElementById('date').valueAsDate = new Date();
  </script>
</body>
</html>
